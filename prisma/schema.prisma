generator client {
  provider = "prisma-client"
  output   = "../app/generated/prisma"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}


enum StoreType {
  Regular
  System
  MultiStore
}

model Store {
  id          String    @id @default(cuid())
  name        String    @unique
  description String?
  type        StoreType @default(Regular)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt

  users       User[]
}

model User {
  id          String   @id @default(cuid())
  firstName   String
  lastName    String
  email       String   @unique
  phoneNumber String?
  address     String?
  passwordHash    String
  permissions UserPermission[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  storeId     String
  store       Store    @relation(fields: [storeId], references: [id])

  @@unique([email, storeId], name: "email_store")
  @@index([storeId])
}

model Permission {
  id          String @id @default(cuid())
  name        String @unique
  description String?

   users UserPermission[]
}

model UserPermission {
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
  userId String

  permission   Permission @relation(fields: [permissionId], references: [id], onDelete: Cascade)
  permissionId String

  assignedAt DateTime @default(now())

  @@id([userId, permissionId]) // Composite primary key
}